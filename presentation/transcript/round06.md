Good afternoon everyone. Thank you for coming to my talk. Django as a database documentation tool, the hidden power of model comments. I'll be talking about how to get to a self-documenting database. And I'm excited to give you this talk about a simple but powerful feature introduced in Django 4.2 that can transform, I believe, how your team works with databases.

A bit about me. I'm Ryan Cheely. I'm a member of the Django Commons admin team with Daniel, Lacey, Storm, and Tim. Some of them are in the audience today. I've been a navigator in Django Not Space. Session 5 is coming up if you are interested in that. I'm also one of the maintainers of Django packages with Jeff and Maxoodle. I've been in healthcare for 17 years. I've been working with Python for about 9 and Django for about 7.

Why this talk? I believe in the importance of documentation and the great benefit that it can have on intra-team and inter-team communication. So I'm going to walk through a real scenario here, and I want to show you what happens when a web developer adds a new database field without proper documentation.

Web developer posts in Slack, just push new field CHAD score to patient risk model. This looks innocent enough, right? But then the ETL developer sees this new field and knows that it needs to be added to the data warehouse and asks, "Well, hey, I need to add this to the risk dimension, but I also need to document what it's used for." And then the report developer who's going to end up using that data in the data warehouse comes in and says, "I also need to know a little bit about this because it's going to go into a new dashboard." And the sooner this data can be loaded into the data warehouse, the better.

So this is where the pain starts, right? Multiple teams the ETL team and the report development team are blocked waiting for clarification. Now they've asked the web developer and sometime later, maybe three minutes, maybe three hours, maybe three days, the answer comes back. The web developer provides this. It's the CHA2DS2-VASC stroke risk score. So we had to wait a while to get this answer, but we still have no real idea what the chat score actually does.

So there's a real cost here, right? The ETL pipeline is delayed because the developer's waiting for clarification on what the field is and how to document it best, which blocks the report developer from updating their dashboard because they need requirements for the dimension that the ETL developer's gonna work on. And there's also real loss here for the initial web developer because they had to go back and consult their notes or maybe reach out to the business analyst that gave them the specs, or maybe find a subject matter expert that can provide them with real information about what this field is.

And so let me be clear, this isn't just a minor inconvenience, right? A lot of people on a lot of different teams are having to wait, all because this wasn't documented in a place that they could appreciate. The ETL pipelines get delayed because the data engineers don't know what the field contains. The report development stops because business intelligence teams can't create accurate dashboards without understanding the data. And the original developer, or developer productivity suffers across all teams, not just the original developer.

And so let's take a look at the current state. Now this is what our database looks like today, our database table at the very least, with this patient risk, patient risk assessment table. And it looks clean, it's functional, everything works the way that it should, but all of these fields are completely opaque. I mean, just look at those names, has-Bled score, QRISC-3 value, contraindication flags, and the CHADS score that we just added.

Now, if you're not in healthcare, these probably mean nothing. And I'll tell you, even if you are in healthcare, they still might not mean anything, because these are related to cardiology. And so when a database administrator comes and looks at this, they may have no real idea what any of these fields are, why they're important, why they matter. And so we have this actual problem, right? What do these cryptic field names actually mean? This is the root of our problem. The database itself will contain no business context.

So quick show of hands. This is a screenshot from a PG admin looking at a specific field. How many people knew that fields could have comments on them inside of pgadmin. Okay. How many of you have ever actually seen those filled in? Okay.

And so there's a documentation gap here, right? Traditional documentation approaches aren't necessarily gonna work. Code comments are not the same as database documentation. They're great for the web developers or the people who are actually working on the code to see what's going on. But people without access to that code, typically your data scientists, your DBAs, they're not gonna be able to see it because they will typically only have access directly to the database.

Try as you might to keep your knowledge management system or wiki pages, confluence, whatever up to date, they can go stale. Someone writes a new function, adds a new field, but they forget to update the documentation. And undocumented expertise, that is the idea that we'll just ask Sarah, she knows, that doesn't scale well or at all, and it can create a single point of failure. This can potentially work on small teams, right? Go ask Sarah, there's only one of them. But go ask Sarah in many contexts, once you get large enough, the question can be which one or who's Sarah?

And in healthcare, we have regulatory requirements. And in many cases, but not all, the auditors actually want to see the databases and they want to see the documentation on those databases to determine what fields we are using to collect data about our patients.

So you might ask, you might say, "Hey Ryan, there's that help text, why can't we just use that?" And there are some limitations, because this doesn't actually solve the problem. The help text is designed for end users filling out forms. It's UI-focused guidance. The problem is it's only visible in forms, either on the front end or in Django Admin. And if you're a DBA or someone else with direct database access using PGAdmin, or a data analyst using Tableau, or an ETL developer building data pipelines, you'll likely never see this text. So it's a tool and it can be a right tool, but in this case it's for the wrong audience.

And so just to give an example, like a front end might have the chat score and the chat score could have this very helpful help text at the bottom. But again, if you don't get to see the front end, you're never going to be able to see this.

And so it's at this point we need to acknowledge that we have different audiences that have different needs. Different stakeholders, we have end users who need form guidance and the help text will be helpful for them. DB comment, they're never going to see it. Our web developers who need to know field purpose, the help text might help them, but again, a DB comment will probably have a lot more context for them. DBAs, want to know about the schema, help text, not so much. DB comment, for the win. Auditors, from a compliance perspective, the help text, maybe it helps them, maybe it doesn't, but the DB comments are gonna be what they want. Our data analysts need to have context about the database. Again, help text, not so much. DB comments, yes.

And so data teams that are using things like SSRS or Power BI or Tableau to create visualizations or reports and typically only have access directly to a reporting database or the database in general, like they can't see the help text. Regulatory auditors are gonna be examining databases directly, not Django admin, not the front end. And our ETL developers, the ones that are building the data pipelines, They're just not going to have context if you only put this type of information into the help text.

And so in Django 4.2, we got a new attribute, db comment. Django 4.2 was introduced on April 3, 2023, which was almost two and a half years ago. How many of you all are using that now? Okay.

And so we can see that with that chance score, we could add a DB comment that gives a little more context. That it's a risk score, goes from zero to nine, and a value greater than two indicates anticoagulation consideration based off of ESC guidelines for 2010. By simply adding this field definition, you put documentation directly into your database schema. And just notice how clean it is. All we added was the db comment with a description of what the field contains.

Now, the magic happens here when Django generates the migration. It puts this comment directly into the database where anyone with database access can see it. And so documentation lives in the database itself. It's a huge win.

What that will generate, what the SQL that will end up being generated at the end, will look very much like what we've seen probably before if you've ever dove into what the SQL statements look like from a migration. It's going to create a table. It's going to add the chat score here. But then... Oh. The second part that this generates is a comment on the column, and it's that same comment that was put into db comment. So now anyone that can query the database can see the documentation.

If you're using pgAdmin, this is what you'd see. You have a comment that "comment matches what was put into dbcomment." Now before we had these mystery fields, ETL and report developers have no idea what these fields represent. And if we're being honest with ourselves, the web developers that are generating this in three months, six months, nine months, are probably not going to remember either.

So, let's do a before and after comparison to show how the DB comment can help. So here we see the typical Django code model code. It's clean and functional, but it doesn't tell us anything about business logic. The ETL developer, were they to dive into the web code, could look at this and have no idea what the chat score represents. Is it a percentage? A risk level? Something else. The report developer can't build meaningful dashboards without context, and again, this doesn't tell them anything.

So let's start adding DB comments. And now, if we look at the CHAD score, we have the DB comment again. CHAD is the CHA2DS2-VASC stroke risk, which goes from 0 to 9, a greater than 2 indicates anticoagulation considerations per the 2010 ESC guidelines. And this is what it looks like inside of the PGA admin.

Well let's take a look at the HAZBLED score. Well it's an indication of a bleeding risk. The value of greater than 3 indicates a high bleeding risk based off of FDA guidance from 2019. So now we're going to have context for our ETL developers or anyone who has direct access the database because again we have this great comment inside of the field in pgadmin.

But let's take a look at something maybe a little more complex: a JSON field. JSON fields can have all sorts of different keys in them potentially, but this one in particular is only going to have three which are documented here in the db comment: Warfarin, Allergy, Bleeding Disorder, and Pregnancy Status, and they're only Boolean values.

Now, this matters because the ETL developer now knows the JSON structure without having to dig through all the Django code. And they can potentially, if the requirements make it so, or if it's such that the requirements are, they can turn these distinct keys inside of the JSON field into their own attributes on a dimension that can be used for reporting later on, so that it's much easier for those reports to be written by our report developers or our data scientists to use that data.

Because this is great, we now have the ability to document in the database what our fields actually mean. Right here we see, well, this one, the contraindication flags, they have keys, and they're only going to be Boolean values.

So you might ask next, "Well, Ryan, should we ditch the help text and only use the db comment?" And I would say no. You should use both of these features and you should have them work together. The help text is for data entry users and the db comment is for database users. So best practice is like let's let the help text be the help text. Let's let it tell people things about the specific field when they're doing the data entry. For this one, for the chat score from what we saw before, it's going to go from a range of zero to nine. Now you still want to have validation on your field of course, but you do have this helpful text there that tells them. The DB comment, again, is used for people with direct access to the database. So use both because they serve different audiences for different needs.

Okay, great. So I've been talking about DB comment, but wouldn't it be awesome if you could apply this at a table level as well? Well, fortunately you can, because in Django 4.2, we added the DB table comment. Now, I don't really like going into the release notes, but I thought this was super helpful. The comment on the database table to use for this model: "It is useful for documenting database tables for individuals with direct database access who may not be looking at your Django code."

So what would this look like? Well, you would look at the meta class on your model class. You would add a DB comment, and we can see here that this specific model that we've been talking about is actually a cardiovascular risk calculations per the Joint Commission's PC-03. We've also added a nice little thing here that tells us who the owner of this specific table is. Not only who they are, but what their contact information is, their email address. So this is owned by the cardio team who can be reached at cardioteam@example.com.

So now we have this great table level documentation. We know what this table is, and we know who this table is for. We know the point of contact, and this allows for a much easier investigation when something does come up or you have questions about specific attributes in the table that maybe aren't in the documentation yet, but they will be. And again, this is what it would look like inside of PG Admin.

So we want to get full documentation for everyone, right? The end users are going to use the help text, the web developers, the help text, and the DB comment. But everyone else is going to be looking to DB comment because they're living inside of the database. This is where they need to see that information.

Okay, hopefully I have convinced you of the awesomeness that is DB comment. But where do you start? It's not as hard as you might think.

Step one: Audit your existing models. Look for models with cryptic names or maybe complex business logic. Start with your top 10 most confusing. Look back at your retrospectives from the last three or six months. What new implementations were done that caused the most confusion? Start there.

Document. If you do this right, you'll only have to do it once, so go hard at it. Find out as much as you can about these columns and distill it into something that can be put into a db comment.

And then standardize. Update your code review practices, checklists, whatever that might be, to include the use of db comment for all new fields. You could also start adding tests that will fail if db comment is missing. But that's a decision you would want to make with your team. And change your mindset here, too, because you want to make documentation a habit and not just an afterthought.

DB table comment, very similar to DB comment. Audit your existing models. Look for tables with cryptic names like I_7542-69. I'm sure it made sense when the table was created, but it doesn't make sense anymore. Find out as much as you can about them. Who are the owners? What are their purposes? Dive deep into it. Add what you find to your DB table comments in the Metaclass of your model classes. And standardize. Make sure that all new tables, all new models get this treatment.

So I hope I've been able to convince you of the power and usefulness of DB comment and DB table comment. And that you can make documentation a habit and not just an afterthought.

Thank you so much for your attention. I hope this simple Django feature can help reduce some of the database confusion in your teams. Remember, documentation is not just about helping others, it's also about helping your future self. Hope you enjoy the rest of DjangoCon, and if you want to find me online, you can find me in these different spots and I will take questions now. Thank you so much.
